# üéØ Barcode Tracking System - Testing Guide

## Overview
This guide will help you test the complete barcode generation ‚Üí print ‚Üí scan ‚Üí process flow on both web and mobile apps.

## üìã Prerequisites

1. **All services running:**
   ```bash
   cd /Users/hemantsinghnagarkoti/Documents/projects/zipybills
   pnpm dev:barcode
   ```

2. **Services should be running on:**
   - Web App: http://localhost:3001
   - Scanning Service: http://localhost:3003
   - Orders Service: http://localhost:3004
   - Inventory Service: http://localhost:3005
   - Mobile App: Expo on port 8081

---

## üß™ Test Flow

### Test Scenario 1: Generate and Process Barcode (Web App)

#### Step 1: Generate Barcode (Machine 1)
1. Open web app: http://localhost:3001
2. Click "Scanner" in the navigation
3. Select "Machine 1" from dropdown
4. Click **"üé´ Generate Barcode"** button
5. **Expected Result:** A unique barcode appears (e.g., `BC17388760001234`)
6. Click **"üñ®Ô∏è Print Barcode"** to open print dialog
7. Note down the barcode for next steps

#### Step 2: Process at Machine 2
1. Change machine selector to **"Machine 2"**
2. Enter the generated barcode in the input field
3. Click **"‚úÖ Process Barcode"**
4. **Expected Result:**
   - Success message: "Barcode processed by Machine 2"
   - Processing history shows:
     - Machine 1: Generated
     - Machine 2: Processed

#### Step 3: Try to Re-Process at Same Machine (Error Test)
1. Keep "Machine 2" selected
2. Enter the same barcode again
3. Click **"‚úÖ Process Barcode"**
4. **Expected Result:** Error message - "Machine 2 has already processed this barcode"

#### Step 4: Process at Machine 3
1. Change machine selector to **"Machine 3"**
2. Enter the same barcode
3. Click **"‚úÖ Process Barcode"**
4. **Expected Result:**
   - Success message
   - Processing history shows all 3 machines

#### Step 5: Process at Machine 4 (Final)
1. Change machine selector to **"Machine 4"**
2. Enter the same barcode
3. Click **"‚úÖ Process Barcode"**
4. **Expected Result:**
   - Success message
   - Complete processing history for all 4 machines

---

### Test Scenario 2: Test with Demo Data

The system comes pre-loaded with 5 demo barcodes. Test these:

#### Demo Barcodes:
1. `DEMO_BARCODE_001` - Processed by all 4 machines
2. `DEMO_BARCODE_002` - Processed by machines 1, 2, 3
3. `DEMO_BARCODE_003` - Processed by machines 1, 2
4. `DEMO_BARCODE_004` - Processed by machines 1, 2
5. `DEMO_BARCODE_005` - Processed by machine 1 only

#### Test Steps:
1. Try processing `DEMO_BARCODE_001` at Machine 1
   - **Expected:** Error (already processed)
2. Try processing `DEMO_BARCODE_005` at Machine 2
   - **Expected:** Success
3. Try processing `DEMO_BARCODE_003` at Machine 3
   - **Expected:** Success
4. Try processing `DEMO_BARCODE_002` at Machine 4
   - **Expected:** Success

---

### Test Scenario 3: Invalid Barcode (Error Handling)

1. Select any machine
2. Enter a non-existent barcode: `INVALID_BARCODE_123`
3. Click **"‚úÖ Process Barcode"**
4. **Expected Result:** Error - "Barcode not found. Please generate it first."

---

### Test Scenario 4: Mobile App Testing

#### On Physical Device (with Expo Go SDK 54):
1. Open Expo Go app on your phone
2. Scan the QR code from terminal
3. App should load with navigation
4. Click "Scanner" tab
5. Follow same test steps as web app

#### On iOS Simulator:
```bash
# In terminal running pnpm dev:barcode, press 'i' or run:
pnpm dev:barcode-ios
```

1. Simulator opens automatically
2. Test same flow as web app
3. **Note:** Camera won't work in simulator, use manual entry

---

## üìä API Endpoints for Testing

### 1. Generate Barcode
```bash
curl -X POST http://localhost:3003/api/barcode/generate \
  -H "Content-Type: application/json" \
  -d '{"machineId": 1}'
```

**Response:**
```json
{
  "success": true,
  "barcode": "BC17388760001234",
  "message": "Barcode generated successfully"
}
```

### 2. Get All Barcodes
```bash
curl http://localhost:3003/api/barcodes
```

**Response:**
```json
{
  "success": true,
  "barcodes": [
    {
      "barcode_id": 1,
      "barcode": "DEMO_BARCODE_001",
      "generated_by_machine": 1,
      "status": "ACTIVE",
      "generated_at": "2026-02-06T..."
    }
  ]
}
```

### 3. Get Barcode Details
```bash
curl http://localhost:3003/api/barcode/DEMO_BARCODE_001
```

**Response:**
```json
{
  "success": true,
  "barcode": {
    "barcode_id": 1,
    "barcode": "DEMO_BARCODE_001",
    "status": "ACTIVE"
  },
  "history": [
    {
      "machine_id": 1,
      "notes": "Generated by Machine 1",
      "machine_parameters": "{...}"
    },
    {
      "machine_id": 2,
      "notes": "Processed by Machine 2",
      "machine_parameters": "{...}"
    }
  ]
}
```

### 4. Process/Scan Barcode
```bash
curl -X POST http://localhost:3003/api/scan \
  -H "Content-Type: application/json" \
  -d '{
    "barcode": "DEMO_BARCODE_005",
    "machineId": 2,
    "parameters": {
      "temperature": 27.5,
      "pressure": 103.2
    },
    "notes": "Test processing"
  }'
```

**Success Response:**
```json
{
  "success": true,
  "message": "Barcode processed by Machine 2",
  "history": [...]
}
```

**Error Response (already processed):**
```json
{
  "success": false,
  "error": "Machine 2 has already processed this barcode"
}
```

### 5. Get Processing Status Dashboard
```bash
curl http://localhost:3003/api/status
```

**Response:**
```json
{
  "success": true,
  "status": [
    {
      "barcode": "DEMO_BARCODE_001",
      "generated_at": "2026-02-06T...",
      "machines_processed": 4,
      "machine_ids": "1,2,3,4",
      "last_machine": 4
    }
  ]
}
```

---

## üéØ Expected Behavior

### ‚úÖ Valid Operations:
- Generate new barcode ‚Üí Success
- Process barcode at Machine N (first time) ‚Üí Success
- Process same barcode at Machine N+1 ‚Üí Success
- View processing history ‚Üí Shows all machines

### ‚ùå Invalid Operations (Should Show Errors):
- Process non-existent barcode ‚Üí Error: "Barcode not found"
- Process same barcode at same machine twice ‚Üí Error: "Already processed"
- Submit empty barcode ‚Üí Error: "Please enter a barcode"

---

## üì± Mobile vs Web Differences

| Feature | Web | Mobile |
|---------|-----|--------|
| Barcode Generation | ‚úÖ Works | ‚úÖ Works |
| Manual Barcode Entry | ‚úÖ Works | ‚úÖ Works |
| Print Barcode | ‚úÖ Works | ‚ö†Ô∏è Uses device print |
| Camera Scanning | ‚ùå Not implemented | ‚ùå Not implemented yet |
| Processing History | ‚úÖ Works | ‚úÖ Works |

**Note:** Camera scanning will require:
- Web: `@zxing/library` or browser WebRTC
- Mobile: `expo-barcode-scanner`

---

## üîç Debugging

### Check Service Status:
```bash
# Scanning Service
curl http://localhost:3003/health

# Expected: {"service":"scanning","status":"ok"}
```

### View Database Contents (from backend):
The scanning service uses in-memory SQLite, so data resets on restart.

### Common Issues:

1. **"Failed to connect to server"**
   - Ensure `pnpm dev:barcode` is running
   - Check port 3003 is not blocked

2. **No demo data**
   - Restart scanning service (Ctrl+C and run again)
   - Demo data loads automatically on startup

3. **Mobile app not loading**
   - Ensure Expo Go app is SDK 54
   - Check phone and computer are on same WiFi

---

## üìà Success Criteria

‚úÖ **Test Passed If:**
1. Can generate unique barcodes
2. Can print barcode (opens print dialog)
3. Can scan/process barcode at each machine
4. Gets error when trying to process same barcode twice at same machine
5. Can process barcode sequentially through machines 1‚Üí2‚Üí3‚Üí4
6. Processing history shows all machines correctly
7. Works on both web and mobile
8. Demo barcodes work correctly

---

## üöÄ Next Steps

After completing these tests, you can:

1. **Add Camera Scanning:**
   - Web: Integrate `@zxing/library`
   - Mobile: Use `expo-barcode-scanner`

2. **Add Persistent Storage:**
   - Replace in-memory SQLite with file-based
   - Or connect to SQL Server/PostgreSQL

3. **Add Barcode Image Generation:**
   - Use `jsbarcode` or `bwip-js` libraries
   - Generate scannable barcode images

4. **Add Reports/Dashboard:**
   - Total barcodes generated
   - Processing statistics by machine
   - Time-based analytics

---

## üìû Support

If you encounter issues:
1. Check all services are running (`pnpm dev:barcode`)
2. Check terminal logs for errors
3. Verify ports 3001, 3003-3005, 8081 are available
4. Restart services if needed

Happy Testing! üéâ
