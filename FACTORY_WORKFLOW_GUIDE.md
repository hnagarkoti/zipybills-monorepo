# ğŸ­ Factory Workflow Guide - Barcode Tracking System

## Real-World Factory Setup

### Physical Setup
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Factory Floor                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  Machine 1          Machine 2          Machine 3       Machine 4 â”‚
â”‚  (Tablet 1)         (Tablet 2)         (Tablet 3)      (Tablet 4)â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ App     â”‚       â”‚ App     â”‚        â”‚ App     â”‚     â”‚ App    â”‚â”‚
â”‚  â”‚ Machine â”‚       â”‚ Machine â”‚        â”‚ Machine â”‚     â”‚ Machineâ”‚â”‚
â”‚  â”‚ ID: 1   â”‚       â”‚ ID: 2   â”‚        â”‚ ID: 3   â”‚     â”‚ ID: 4  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚      â†“                  â†“                  â†“               â†“      â”‚
â”‚  [Generate]         [Scan]             [Scan]          [Scan]    â”‚
â”‚  [Print]           [Process]          [Process]       [Process]  â”‚
â”‚                                                                   â”‚
â”‚         Product Flow: Machine 1 â†’ 2 â†’ 3 â†’ 4                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Database (Centralized - SQL Server)
- All machines connect to **same database** (localhost:1433)
- Each machine records its processing in `machine_data` table
- Complete history tracked: which machines processed which products

---

## ğŸ“± Step-by-Step: Testing the Workflow

### âœ… Step 1: Start the System

**Open Terminal:**
```bash
cd /Users/hemantsinghnagarkoti/Documents/projects/zipybills
pnpm dev:barcode
```

**Wait for all services to start:**
```
âœ… Web: http://localhost:3001
âœ… Scanning Service: Port 3003 (connected to SQL Server)
âœ… Orders Service: Port 3004
âœ… Inventory Service: Port 3005
```

---

### âœ… Step 2: Machine 1 - Generate & Print Barcode

**Role:** Machine 1 Operator (Product Creation)

**Open Browser:**
```
http://localhost:3001/scanner
```

**Actions:**
1. **Select Machine:** Choose "Machine 1" from dropdown
2. **Generate:** Click "Generate Barcode" button
3. **Result:** You'll see a barcode like `BC1738875432001`
4. **Print:** Click "Print Barcode" button (opens print dialog)
5. **Real Factory:** Operator prints label and sticks on product

**What Happened in Database:**
```sql
-- New row in barcodes table
INSERT INTO barcodes (barcode, generated_by_machine) 
VALUES ('BC1738875432001', 1);

-- Machine 1 processing record
INSERT INTO machine_data (barcode, machine_id, machine_parameters, notes)
VALUES ('BC1738875432001', 1, '{"temperature":25,"pressure":101.3}', 'Generated by Machine 1');
```

ğŸ“¸ **Screenshot Location:** Product now has barcode label, moving to Machine 2

---

### âœ… Step 3: Machine 2 - Scan & Process

**Role:** Machine 2 Operator (First Processing)

**In Same Browser (or New Tab):**
```
http://localhost:3001/scanner
```

**Actions:**
1. **Select Machine:** Choose "Machine 2" from dropdown
2. **Scan Barcode:** 
   - Real Factory: Use barcode scanner device
   - Testing: Type `BC1738875432001` (the barcode from Step 2)
3. **Process:** Click "Process Barcode" button
4. **Result:** You'll see success message and processing history shows:
   ```
   Machine 1: âœ… Processed (generated)
   Machine 2: âœ… Processed (just now)
   ```

**What Happened in Database:**
```sql
-- Machine 2 processing record
INSERT INTO machine_data (barcode, machine_id, machine_parameters, notes)
VALUES ('BC1738875432001', 2, '{"temperature":27,"pressure":103}', 'Processed by Machine 2');
```

---

### âœ… Step 4: Machine 3 - Scan & Process

**Role:** Machine 3 Operator (Second Processing)

**Same App, Different Machine ID:**
1. **Select Machine:** Choose "Machine 3" from dropdown
2. **Scan Barcode:** Type same barcode `BC1738875432001`
3. **Process:** Click "Process Barcode" button
4. **Result:** Processing history now shows:
   ```
   Machine 1: âœ… Processed
   Machine 2: âœ… Processed
   Machine 3: âœ… Processed (just now)
   ```

---

### âœ… Step 5: Machine 4 - Final Processing

**Role:** Machine 4 Operator (Final Quality Check)

**Same App, Different Machine ID:**
1. **Select Machine:** Choose "Machine 4" from dropdown
2. **Scan Barcode:** Type same barcode `BC1738875432001`
3. **Process:** Click "Process Barcode" button
4. **Result:** Processing history shows all 4 machines completed

**Product is now finished!** ğŸ‰

---

## ğŸš« Testing Duplicate Prevention

**What happens if you try to scan the same barcode on the same machine twice?**

**Try This:**
1. Keep Machine 2 selected
2. Try to process `BC1738875432001` again
3. **Result:** âŒ Error message: "Machine 2 has already processed this barcode"

**Why?** The database has constraint:
```sql
CONSTRAINT UQ_barcode_machine UNIQUE (barcode, machine_id)
```

This prevents duplicate processing!

---

## ğŸ“Š View All Data

### Check SQL Server Database

**Open SQL Server Management Studio or Azure Data Studio:**
```sql
-- View all barcodes
SELECT * FROM barcodes 
ORDER BY generated_at DESC;

-- View all processing history
SELECT 
    md.barcode,
    md.machine_id,
    md.processed_at,
    md.machine_parameters,
    md.notes
FROM machine_data md
JOIN barcodes b ON md.barcode = b.barcode
ORDER BY b.generated_at DESC, md.machine_id;

-- Check which products completed all 4 machines
SELECT 
    b.barcode,
    COUNT(DISTINCT md.machine_id) as machines_completed,
    STRING_AGG(CAST(md.machine_id AS VARCHAR), ',') as machine_ids
FROM barcodes b
LEFT JOIN machine_data md ON b.barcode = md.barcode
GROUP BY b.barcode
HAVING COUNT(DISTINCT md.machine_id) = 4;
```

---

## ğŸ§ª Testing with Demo Data

**Pre-loaded Demo Barcodes:**

| Barcode | Status | Already Processed By |
|---------|--------|---------------------|
| `DEMO_BARCODE_001` | Completed All | Machines 1,2,3,4 |
| `DEMO_BARCODE_002` | Partial | Machines 1,2,3 |
| `DEMO_BARCODE_003` | Partial | Machines 1,2 |
| `DEMO_BARCODE_004` | Partial | Machines 1,2 |
| `DEMO_BARCODE_005` | New | Machine 1 only |

**Test Scenarios:**

### Scenario 1: Continue Processing
- Select Machine 4
- Scan `DEMO_BARCODE_002`
- âœ… Should work (Machine 4 hasn't processed it yet)

### Scenario 2: Duplicate Detection
- Select Machine 2
- Scan `DEMO_BARCODE_001`
- âŒ Should fail (Machine 2 already processed it)

### Scenario 3: New Product
- Select Machine 2
- Scan `DEMO_BARCODE_005`
- âœ… Should work (only Machine 1 processed it)

---

## ğŸ­ Real Factory Deployment

### Setup for Each Machine

**Machine 1 Tablet:**
```bash
# Install app
cd /path/to/app
pnpm install

# Configure machine ID in environment or UI
MACHINE_ID=1

# Start app
pnpm dev:barcode-web
# OR for mobile
pnpm dev:barcode-mobile
```

**Machine 2 Tablet:**
```bash
MACHINE_ID=2
pnpm dev:barcode-web
```

**Machine 3 Tablet:**
```bash
MACHINE_ID=3
pnpm dev:barcode-web
```

**Machine 4 Tablet:**
```bash
MACHINE_ID=4
pnpm dev:barcode-web
```

### Network Configuration

**All tablets connect to central SQL Server:**

**Update `.env` on each tablet:**
```env
DB_HOST=192.168.1.100  # Your SQL Server IP
DB_PORT=1433
DB_NAME=production_barcode_db
DB_USER=factory_app
DB_PASSWORD=SecurePassword123!
```

---

## ğŸ“± Mobile App Testing (on Physical Device)

**Why Mobile?** Operators can walk around with tablets/phones with barcode scanners

**Start Mobile App:**
```bash
pnpm dev:barcode-mobile
```

**Scan QR Code with Expo Go app**

**On Mobile:**
1. Machine dropdown appears at top
2. Select machine (1, 2, 3, or 4)
3. Future: Tap "Scan with Camera" to use device camera
4. Current: Type barcode manually
5. Tap "Process Barcode"

---

## ğŸ” Understanding the Flow

### Centralized Database Approach

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SQL Server (localhost:1433)              â”‚
â”‚                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   barcodes      â”‚     â”‚    machine_data      â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ BC1738875432001 â”‚â”€â”€â”€â”€â†’â”‚ Machine 1: âœ…        â”‚   â”‚
â”‚  â”‚ BC1738875432002 â”‚     â”‚ Machine 2: âœ…        â”‚   â”‚
â”‚  â”‚ DEMO_BARCODE_001â”‚     â”‚ Machine 3: âœ…        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ Machine 4: âœ…        â”‚   â”‚
â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘            â†‘            â†‘            â†‘
         â”‚            â”‚            â”‚            â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”   â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚Machine1â”‚   â”‚Machine2â”‚  â”‚Machine3â”‚  â”‚Machine4â”‚
    â”‚ Tablet â”‚   â”‚ Tablet â”‚  â”‚ Tablet â”‚  â”‚ Tablet â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Benefits:**
- âœ… Real-time tracking across all machines
- âœ… Prevents duplicate processing
- âœ… Complete audit trail
- âœ… Can query status of any product
- âœ… Dashboard shows factory-wide metrics

---

## ğŸ¯ Quick Test (5 Minutes)

**Complete Factory Simulation:**

1. **Open:** http://localhost:3001/scanner
2. **Machine 1:** Generate â†’ `BC1738875432001` â†’ Print
3. **Machine 2:** Scan â†’ `BC1738875432001` â†’ Process â†’ âœ…
4. **Machine 3:** Scan â†’ `BC1738875432001` â†’ Process â†’ âœ…
5. **Machine 4:** Scan â†’ `BC1738875432001` â†’ Process â†’ âœ…
6. **Machine 2 Again:** Scan â†’ `BC1738875432001` â†’ âŒ Duplicate Error

**Open SQL Server:**
```sql
SELECT * FROM machine_data 
WHERE barcode = 'BC1738875432001'
ORDER BY machine_id;
```

**Result:** See 4 rows (one per machine) âœ…

---

## ğŸš€ Next Steps

### Phase 1: Current (Testing)
- âœ… Manual barcode entry
- âœ… Machine selection dropdown
- âœ… SQL Server connection
- âœ… Processing history

### Phase 2: Production Ready
- [ ] Camera-based barcode scanning
- [ ] Auto-detect machine ID from device/tablet
- [ ] Offline mode with sync
- [ ] Print to label printer (not just browser print)

### Phase 3: Advanced Features
- [ ] Real-time dashboard (factory overview)
- [ ] Quality control parameters per machine
- [ ] Defect tracking
- [ ] Production reports
- [ ] Export to Excel

---

## ğŸ’¡ Key Concepts

### Same App, Different Context
- **One Codebase:** Single app deployed to all machines
- **Different Machine ID:** Each tablet configured for its machine
- **Shared Database:** All connect to same SQL Server
- **Role-Based:** Machine 1 generates, others scan & process

### Why This Architecture Works
1. **Easy Updates:** Update one app, deploy to all machines
2. **Consistent UI:** All operators see same interface
3. **Centralized Data:** Real-time visibility across factory
4. **Scalability:** Add Machine 5, 6, 7... just configure new tablets

---

## ğŸ“ Support

**Having Issues?**
1. Check if all services are running (`pnpm dev:barcode`)
2. Verify SQL Server is accessible (test connection)
3. Check logs in terminal for errors
4. See [BARCODE_TESTING_GUIDE.md](BARCODE_TESTING_GUIDE.md) for API details
